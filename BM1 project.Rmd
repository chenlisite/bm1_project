---
title: "BM1 project"
author: "Chen Li"
date: "December 10, 2017"
output: html_document
---


```{r setup, echo = FALSE, message = FALSE, results = FALSE, warning = FALSE}
library(ISLR)                          
library(psych)                         # R data description
library(boot)                          # For cv.glm()
library(MPV)                           # For PRESS criterion

library(tidyverse)
library(tidytext)
library(broom) #BMI
library(curl)
library(data.table)
library(dplyr)
library(DT)
library(faraway)
library(forcats)
library(ggplot2)
library(ggridges)
library(ggthemes)
library(haven)
library(HH) #BMI
library(htmltools)
library(janitor)
library(jtools)
library(knitr)
library(knitLatex)
library(leaps) #BMI
library(magrittr)
library(olsrr)
library(readr)
library(readxl)
library(reshape2)
library(rvest)
library(stringr)
library(tools)
library(viridisLite)
library(xtable)

#create fxn for full library load
#watch jg lecture videos for this hw

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%")
```

```{r clean dataset}
patientdata = read_excel("GHProject_Dataset.xlsx") %>% 
  clean_names()%>%
  separate(admitdtm, into = c("week", "month","year"), sep = ",")%>%
  mutate(
         day = str_sub(month,-3,-1),
       month = str_sub(month, 1, -4))%>%
  mutate(month= as.numeric(factor(substr(month,2,4), levels = month.abb)))%>%
  arrange(by=patientid,year,month, day)%>%
  distinct(patientid, .keep_all = TRUE) %>% 
  rename(
    age = ageyear, 
    marital_status = maritalstatus, 
    insurance_type = insurancetype,
    facility = facilityname, 
    facility_zip = facilityzip,
    postal_code = postalcode,
    los_hours = loshours, 
    los_days = losdays2,
    o2_sat = o2sat,
    respiration_rate = respirationrate, 
    heart_rate = heartrate, 
    bp_systolic = bpsystolic, 
    bp_diastolic = bpdiastolic, 
    patient_id = patientid, 
    visit_id = visitid) %>% 
  mutate(
    los_days = round(los_days, 2),
    temperature = round(temperature, 2),
    bmi = round(bmi, 2),
    respiration_rate = round(respiration_rate, 2),
    o2_sat = round(o2_sat, 2),
    heart_rate = round(heart_rate, 2), 
    bp_systolic = round(bp_systolic, 2), 
    bp_diastolic = round(bp_diastolic, 2))

patientdata %>% 
  count(race)
```
  
  
```{r factor recoding}
# cindex: 0=normal,1-2=mild,3-4=moderate,>5=severe
patientdata= patientdata %>%
mutate( cindex = factor(cindex),
        cindex = fct_recode(cindex, 
                         "normal" = "0",
                         "mild" = "1",
                         "mild" = "2",
                         "moderate"= "3",
                         "moderate"= "4",
                         "severe"="5"))

# gender: 0="Female",1="Male"
patientdata$gender<-ifelse(patientdata$gender == "Male",1,0)


#insurance type: 0="Medicaid", 2 = "Medicare", 3="Private"
patientdata= patientdata %>%
mutate(insurancetype = factor(insurancetype),
       insurancetype = fct_recode(insurancetype, 
                         "0" = "Medicaid",
                         "1"="Medicare",       
                         "2"="Private"))

# marital status: 0="married or living as married", 1="widowed or seperated", 2="unmarried"
patientdata= patientdata %>%
mutate( maritalstatus = factor(maritalstatus),
        maritalstatus = fct_recode(maritalstatus, 
                         "0" = "Married",
                         "0"= "Civil Union",
                         "1"= "Widowed",
                         "1" = "Separated",
                         "2"= "Single" ,
                         "2"= "Divorced"))

# mews: 0-1=normal(0), 2-3=increase caution(1), 4-5=further deterioration(2), >5 immediate action required(3)
patientdata=patientdata %>% 
mutate(mews=ifelse(mews >5,3,ifelse(mews >=4,2, ifelse(mews >=2, 1,0))))

# race
patientdata = patientdata %>%
  mutate(race = fct_recode(race, 
                         "0" = "White",
                         "1" = "African Amer/Black",       
                         "2" = "Asian",
                         "3" = "Other/Multiracial",
                         "4" = "Native Amer/Alaskan",
                         "5" = "Natv Hawaii/Pacf Isl"))


```



```{r}
patientdata = patientdata %>% 
  mutate(log_los = log(los_hours))
hist(patientdata$log_los)
```

